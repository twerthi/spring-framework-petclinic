pipeline {
    agent any
    tools {
        jfrog 'JFrog CLI'
    }
    stages {
            stage ('Set version') {
                steps {
                    script {
                        TEST_VAR = new Date().format("yyyy.MM.dd") as String
                        echo "${TEST_VAR}"
                        VERSION_NUMBER = VersionNumber(versionNumberString: "${TEST_VAR}.${BUILD_ID}")
                        currentBuild.displayName = "${VERSION_NUMBER}"
                    }
                }
            }
            stage ('Build') {
                steps {
                    bat "mvn clean package -DskipTests=true -Dproject.versionNumber=${VERSION_NUMBER} -DgroupId=com.octopus -DartifactId=PetClinic.Web"
                    bat "ren target\\petclinic2.* petclinic.*"
                    bat "dir target"
                }
            }
            stage ('Push') {
                steps {
                    jf "rt u target/*.war artifactory-maven/com/octopus/PetClinic.Web/${VERSION_NUMBER}/PetClinic.Web-${VERSION_NUMBER}.war"
                    //jf version
                        }
            }
    }
}
